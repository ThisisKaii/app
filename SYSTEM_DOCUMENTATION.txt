SYSTEM DOCUMENTATION
====================

1. SYSTEM OVERVIEW
------------------
This application is a Project Management & Budgeting System built with Laravel. It allows teams to manage tasks, track budgets, and collaborate in real-time. The system supports multiple board types (e.g., Business, Personal) and implements role-based access control (RBAC).

2. KEY FEATURES
---------------
- **Task Management**: Create, edit, delete, and organize tasks into groups.
- **Kanban & Table Views**: View tasks in a drag-and-drop Kanban board or a structured table view.
- **Budgeting (Business Boards)**: 
    - Create budget categories.
    - Track estimated vs. actual expenses.
    - Add, edit, and delete expenses.
    - Status tracking (Draft, Approved, Completed).
- **Role-Based Access Control (RBAC)**:
    - **Owner**: Full access to all settings, users, and data.
    - **Admin**: Can manage tasks, budgets, and team members.
    - **Member**: Can view content, manage assigned tasks, and add expenses (restricted from changing budget structure).
- **Real-time Updates**: Live updates for tasks and activities using Livewire polling.
- **Activity Logging**: Detailed audit logs for actions taken within the system.
- **Dark Mode Modern UI**: A sleek, dark-themed interface with custom components.

3. TECHNOLOGY STACK
-------------------
- **Framework**: Laravel 10.x
- **Frontend**: Blade Templates, Tailwind CSS
- **Interactivity**: Livewire 3.x, Alpine.js
- **Database**: MySQL / SQLite (configurable)
- **Styling**: Custom "Dark Modern" theme extending Tailwind.

4. INSTALLATION & SETUP
-----------------------
1. **Prerequisites**: PHP 8.1+, Composer, Node.js/NPM.
2. **Clone Repository**: 
   `git clone <repository-url>`
3. **Install Dependencies**:
   `composer install`
   `npm install`
4. **Environment Setup**:
   - Copy `.env.example` to `.env`.
   - Configure database credentials in `.env`.
5. **Key Generation**:
   `php artisan key:generate`
6. **Database Migration**:
   `php artisan migrate`
7. **Build Assets**:
   `npm run dev` (for development) or `npm run build` (for production).
8. **Run Server**:
   `php artisan serve`

5. KEY COMPONENTS
-----------------
- **BudgetBoard**: Main component for the budget visualization.
- **BudgetTableView**: Table representation of the budget.
- **TableView**: Table representation of tasks.
- **TaskGroup/Task**: Core models for task management.
- **BudgetCategory/Expenses**: Core models for financial tracking.
- **Policies**: `BudgetCategoryPolicy` and `ExpensePolicy` handle authorization logic.

6. ROLES & PERMISSIONS
----------------------
| Feature               | Owner | Admin | Member |
|-----------------------|-------|-------|--------|
| Create Tasks          | Yes   | Yes   | Yes    |
| Edit Any Task         | Yes   | Yes   | No     |
| Edit Own Task         | Yes   | Yes   | Yes    |
| Manage Budget Structure| Yes   | Yes   | No     |
| Add Expenses          | Yes   | Yes   | Yes    |
| Invite Members        | Yes   | Yes   | No     |

7. DIRECTORY STRUCTURE HIGHLIGHTS
---------------------------------
- `app/Livewire`: Contains all interactive components (Board, Budget, Table views).
- `app/Policies`: Authorization logic.
- `resources/views/livewire`: Frontend Blade templates for components.
- `routes/web.php`: Application routes.

8. COMPONENT REFERENCE
-----------------------

### BudgetBoard
**Class**: `App\Livewire\BudgetBoard`
**View**: `resources/views/livewire/budget-board.blade.php`
**Purpose**: Manages the Kanban-style view for Budget Boards.
**Custom Methods**:
- `loadBudget()`: Fetches or creates the budget record.
- `loadCategories()`: Loads categories with expenses.
- `openBudgetModal()`: Opens the modal to edit total budget.
- `saveBudget()`: Validates and saves the total budget.
- `closeBudgetModal()`: Closes the budget modal.
- `openCategoryModal($categoryId, $status)`: Opens category add/edit modal.
- `saveCategory()`: Saves a budget category.
- `confirmDeleteCategory($categoryId)`: Sets ID for category deletion.
- `deleteCategory()`: Deletes the confirmed category.
- `closeDeleteCategoryModal()`: Closes the delete confirmation.
- `closeCategoryModal()`: Closes the category modal.
- `resetCategoryForm()`: Resets category input fields.
- `openExpenseModal($categoryId, $expenseId)`: Opens expense add/edit modal.
- `saveExpense()`: Saves an expense record.
- `confirmDeleteExpense($expenseId)`: Sets ID for expense deletion.
- `deleteExpense()`: Deletes the confirmed expense.
- `closeDeleteExpenseModal()`: Closes the expense delete confirmation.
- `closeExpenseModal()`: Closes the expense modal.
- `resetExpenseForm()`: Resets expense input fields.

### BudgetTableView
**Class**: `App\Livewire\BudgetTableView`
**View**: `resources/views/livewire/budget-table-view.blade.php`
**Purpose**: Manages the table view for Budget Boards.
**Custom Methods**:
- `loadBudget()`: Fetches budget data.
- `getCategories()`: Returns paginated categories.
- `paginationView()`: Returns custom pagination view.
- `toggleFilters()`: Toggles filter visibility.
- `clearFilters()`: Resets all filters.
- `openCategoryModal($categoryId)`: Opens category modal.
- `saveCategory()`: Saves category.
- `confirmDeleteCategory($categoryId)`: Prepares category deletion.
- `deleteCategory()`: Performs category deletion.
- `closeDeleteCategoryModal()`: Closes delete modal.
- `closeCategoryModal()`: Closes category modal.
- `resetCategoryForm()`: Resets category inputs.
- `openExpenseModal($categoryId, $expenseId)`: Opens expense modal.
- `saveExpense()`: Saves expense.
- `confirmDeleteExpense($expenseId)`: Prepares expense deletion.
- `deleteExpense()`: Performs expense deletion.
- `closeDeleteExpenseModal()`: Closes expense delete modal.
- `closeExpenseModal()`: Closes expense modal.
- `resetExpenseForm()`: Resets expense inputs.

### TableView
**Class**: `App\Livewire\TableView`
**View**: `resources/views/livewire/table-view.blade.php`
**Purpose**: Manages the table view for standard Task Boards.
**Custom Methods**:
- `getGroups()`: Returns paginated task groups.
- `toggleGroup($groupId)`: Toggles group expansion state.
- `getUsers()`: Returns list of users for assignment.
- `paginationView()`: Returns custom pagination view.
- `toggleFilters()`: Toggles filter visibility.
- `clearFilters()`: Resets filters.
- `openTaskModal($taskId)`: Opens task edit modal.
- `toggleTaskCompletion($taskId)`: Toggles published status.
- `saveTask()`: Saves task details.
- `syncTags($task)`: Syncs tags for a task.
- `showDeleteConfirmation($taskId)`: Prepares task deletion.
- `performDelete()`: Deletes the confirmed task.
- `cancelDelete()`: Cancels deletion logic.
- `closeDeleteModal()`: Closes delete modal.
- `closeModal()`: Closes task modal.
- `resetForm()`: Resets task inputs.
- `getCanEditProperty()`: Computed property for edit permissions.
- `takeTask($taskId)`: Assigns tax to current user.

### Dashboard
**Class**: `App\Livewire\Dashboard`
**View**: `resources/views/livewire/dashboard.blade.php`
**Purpose**: Displays analytics and statistics.
**Custom Methods**:
- `setDateRange($range)`: Updates time filter.
- `loadDashboardData()`: Orchestra method to load all data.
- `loadNormalDashboard()`: Loads stats for standard boards.
- `loadBusinessDashboard()`: Loads stats for budget boards.
- `toggleAllTransactions()`: Toggles visibility of transaction list.

### AddModal
**Class**: `App\Livewire\AddModal`
**View**: `resources/views/livewire/add-modal.blade.php`
**Purpose**: Unified modal for creating new Groups or Tasks.
**Custom Methods**:
- `getListeners()`: Dynamic listeners configuration.
- `getUsersProperty()`: Computed property for users list.
- `getCanAssignProperty()`: Computed property for assignment permission.
- `openGroupModal($status, $groupId)`: Opens modal in Group mode.
- `openTaskModal($taskId, $groupId)`: Opens modal in Task mode.
- `loadGroup($groupId)`: Loads group data for editing.
- `loadTask($taskId)`: Loads task data for editing.
- `save()`: Dispatches to saveGroup or saveTask.
- `saveGroup()`: Persists group data.
- `saveTask()`: Persists task data.
- `askDelete()`: Initiates delete workflow.
- `cancelDelete()`: Cancels delete workflow.
- `delete()`: Deletes the current record (Group or Task).
- `closeModal()`: Closes the modal.
- `resetForm()`: Resets all inputs.

### EditModal
**Class**: `App\Livewire\EditModal`
**View**: `resources/views/livewire/edit-modal.blade.php`
**Purpose**: Handles editing of existing tasks.
**Custom Methods**:
- `loadTasks()`: Refreshes task list for the board.
- `openModal($taskId)`: Opens modal and loads task data.
- `saveTask()`: Updates task details and tags.
- `closeModal()`: Closes the modal.
- `resetForm()`: Resets inputs.

### MembersList
**Class**: `App\Livewire\MembersList`
**View**: `resources/views/livewire/members-list.blade.php`
**Purpose**: Manages board members.
**Custom Methods**:
- `loadBoard()`: Refreshes board and member data.
- `setCurrentUserRole()`: Determines current user's role.
- `toggleFilters()`: Toggles filter UI.
- `clearFilters()`: Resets filters.
- `openAddModal()`: Opens invite modal.
- `closeAddModal()`: Closes invite modal.
- `addMember()`: Invites a user to the board.
- `askDelete($userId)`: Confirm member removal.
- `removeMember()`: Removes confirmed member.
- `cancelDelete()`: Cancels removal.
- `updateRole($userId, $newRole)`: changes member permissions.
- `canManageMembers()`: Permission check helper.

### BudgetCategoryModal
**Class**: `App\Livewire\BudgetCategoryModal`
**View**: `resources/views/livewire/budget-category-modal.blade.php`
**Purpose**: Manages detailed category view.
**Custom Methods**:
- `getListeners()`: Dynamic listeners.
- `loadCategories()`: Refreshes categories.
- `openCategoryModal($categoryId)`: Opens category edit modal.
- `saveCategory()`: Saves category details.
- `confirmDeleteCategory($categoryId)`: Prepares delete.
- `deleteCategory()`: Deletes category.
- `closeDeleteCategoryModal()`: Closes delete modal.
- `closeCategoryModal()`: Closes edit modal.
- `resetCategoryForm()`: Resets inputs.
- `openExpenseModal($categoryId, $expenseId)`: Opens expense modal.
- `saveExpense()`: Saves expense.
- `confirmDeleteExpense($expenseId)`: Prepares expense delete.
- `deleteExpense()`: Deletes expense.
- `closeDeleteExpenseModal()`: Closes expense delete modal.
- `closeExpenseModal()`: Closes expense modal.
- `resetExpenseForm()`: Resets expense inputs.

9. LOGGING SYSTEM
-----------------
The application implements a comprehensive audit logging system.
- **ActivityLog Model**: Records `board_id`, `user_id`, `model_type` (e.g., Task, Expense), `action_type` (created, updated, deleted), and a description.
- **Loggable Trait**: Use `use App\Traits\Loggable;` in any model to automatically log creation, updates, and deletions.
    - **Methods**: `shouldLogActivity()`, `createLog()`, `getLogChanges()`.
    - **Customization**: Models can define `customCreatedDescription()`, `customUpdatedDescription()`, etc. to override default messages.
- **Usage**: Automatically tracks changes to Tasks, TaskGroups, BudgetCategories, and Expenses, providing a "who did what and when" audit trail.

10. AUTHORIZATION POLICIES
--------------------------
Authorization is handled via Laravel Policies and standard Gates.
- **BoardPolicy**: The central policy for board-level actions.
    - `view`/`viewTasks`: Allowed for all members.
    - `update`/`delete`: Restricted to Owner/Admin.
    - `addMember`/`removeMember`: Restricted to Owner/Admin.
    - `createTask`/`updateTask`: Acts as the gate for structural changes (adding/editing Budget Categories). Restricted to Owner/Admin.
    - `addExpense`: Allowed for all members (enabling collaborative expense tracking).
- **TaskPolicy**: Granular control for individual tasks.
    - `update`/`delete`: Owners/Admins can edit all. Members can only edit tasks assigned to them or created by them.
    - `moveStatus`: Members can move their own tasks.
- **TaskGroupPolicy**: Controls high-level task grouping.
    - `update`/`delete`: Restricted to Owner/Admin to prevent members from disrupting the board structure.

11. ENUMS
---------
### TaskStatus
**Namespace**: `App\Enums\TaskStatus`
**Purpose**: Defines the possible states of a task and provides helper methods for UI consistency.
**Cases**: `TODO` ('to_do'), `IN_PROGRESS` ('in_progress'), `IN_REVIEW` ('in_review'), `PUBLISHED` ('published').
**Methods**:
- `label()`: Returns the human-readable string (e.g., "To Do", "Completed").
- `color()`: Returns the hex color code for the status (e.g., "#3fb950").
- `bgColor()`: Returns the rgba background color for badges.
- `isActive()`: Boolean check, returns true if status is not PUBLISHED.
- `activeStatuses()`: Static method returning an array of all non-completed statuses.
- `options()`: Static method returning an array of ['value', 'label'] pairs for dropdowns.
